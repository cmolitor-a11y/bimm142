---
title: "Class 19 Mini Project: Investigating Pertussis Resurgence"
author: "Charlize Molitor ( PID: A18515740)"
format: pdf
toc: TRUE
---

## Background 

Pertussis is a bacterial lung infection also known as Whooping cough. Let's begin by examining CDC reported case numbers in the US


```{r}
cdc <- data.frame(
                                 year = c(1922L,1923L,1924L,1925L,
                                          1926L,1927L,1928L,1929L,1930L,1931L,
                                          1932L,1933L,1934L,1935L,1936L,
                                          1937L,1938L,1939L,1940L,1941L,1942L,
                                          1943L,1944L,1945L,1946L,1947L,
                                          1948L,1949L,1950L,1951L,1952L,
                                          1953L,1954L,1955L,1956L,1957L,1958L,
                                          1959L,1960L,1961L,1962L,1963L,
                                          1964L,1965L,1966L,1967L,1968L,1969L,
                                          1970L,1971L,1972L,1973L,1974L,
                                          1975L,1976L,1977L,1978L,1979L,1980L,
                                          1981L,1982L,1983L,1984L,1985L,
                                          1986L,1987L,1988L,1989L,1990L,
                                          1991L,1992L,1993L,1994L,1995L,1996L,
                                          1997L,1998L,1999L,2000L,2001L,
                                          2002L,2003L,2004L,2005L,2006L,2007L,
                                          2008L,2009L,2010L,2011L,2012L,
                                          2013L,2014L,2015L,2016L,2017L,2018L,
                                          2019L,2020L,2021L,2022L,2023L, 2024L),
         cases = c(107473,164191,165418,152003,
                                          202210,181411,161799,197371,
                                          166914,172559,215343,179135,265269,
                                          180518,147237,214652,227319,103188,
                                          183866,222202,191383,191890,109873,
                                          133792,109860,156517,74715,69479,
                                          120718,68687,45030,37129,60886,
                                          62786,31732,28295,32148,40005,
                                          14809,11468,17749,17135,13005,6799,
                                          7717,9718,4810,3285,4249,3036,
                                          3287,1759,2402,1738,1010,2177,2063,
                                          1623,1730,1248,1895,2463,2276,
                                          3589,4195,2823,3450,4157,4570,
                                          2719,4083,6586,4617,5137,7796,6564,
                                          7405,7298,7867,7580,9771,11647,
                                          25827,25616,15632,10454,13278,
                                          16858,27550,18719,48277,28639,32971,
                                          20762,17972,18975,15609,18617,
                                          6124,2116,3044,7063, 22538)
       )
```


Plot of cases per year for Pertussis in the US

```{r}
library(ggplot2)
ggplot(cdc) +
  aes(year, cases) +
  geom_point() + 
  geom_line()
```

Add some major milestone timepoints to out plot:

```{r}
library(ggplot2)
ggplot(cdc) +
  aes(year, cases) +
  geom_point() + 
  geom_line() +
  geom_vline(xintercept = 1947, col = "darkgreen") +
  geom_vline(xintercept = 1996, col = "red") + 
  geom_vline(xintercept = 2020, col = "pink")
```

The full introduction of the mandatory wP ( whole-cell) Pertussis immunization in the mid 1940s lead to a dramatic reduction in case numbers (from over 200,000 to 100s). 

The switch to the aP (newer acellular formalization) has steadly increased the amount of cases of pertussis. This vaccine is short lived compared to the wp. However, unlike the wP, the aP's side effects are a lot lower. There was an increase in this vaccine because of all of the wP side effects, lot's of people seemed to be concered about the long-term side effects 

The 2020 lock-downs and social distancing measures most likely helped with the decline of the Pertussis bacteria. When people were practicing healthier habits like being 6 feet apart or wearing masks helped with the decline of spread for many other viruses and bacterias. 

## The CMI-BI project 

 The mission of CMI-PB is to provide the scientific community with a comprehensive, high-quality and freely accessible resource of Pertussis booster vaccination.

Website: https://www.cmi-pb.org/

They make their data available via JSON format API endpoints- basically the database tables in a key:value type format like "infancy_vac":"wP". To read this we can use the `read.json()` function for the **jsonlite** package. Install with `install.packages("jsonlite")`

```{r}
library(jsonlite)

subject <- read_json(path = "https://www.cmi-pb.org/api/v5_1/subject", simplifyVector = TRUE)
head(subject)
```

> Q. How many "subjects"/individuals are in this dataset?

```{r}
nrow(subject)
```

> Q. How many wP and aP subjects are there?

```{r}
table(subject$infancy_vac)
```

> Q. What is the breakdown by "biological_sex' and "race"?

```{r}
table(subject$biological_sex)
```

```{r}
table(subject$race)
```

```{r}
table(subject$race, subject$biological_sex)
```

This breakdown is not particulary representative of the US population - thus is a series cavet for this study. However, it is still the largest sample of it's type every assembled. 


```{r}
specimen <- read_json("https://www.cmi-pb.org/api/v5_1/specimen", simplifyVector = TRUE)
ab_titer <- read_json("https://www.cmi-pb.org/api/v5_1/plasma_ab_titer", simplifyVector = TRUE)
```

```{r}
head(specimen)
```



We need to "join" or link these tables with the `subject` table so we can begin to anaylze this data and know who can give Ab sample was collected for and when.

```{r}
library(dplyr)

meta <- inner_join(subject, specimen)
head(meta)
```

Now let's join the `ab_titer` table to out `meta` table so we have all of the informations about a give Ab measurement

```{r}
ab_data <- inner_join(meta, ab_titer)
head(ab_data)
```

> Q. How many Ab measurements do we have in total

```{r}
nrow(ab_data)
```


>Q. How many different isotopes (types of Ab) are in the dataset

```{r}
unique(ab_data$isotype)
```

> Q. How many different antigens?

```{r}
unique(ab_data$antigen)
```

```{r}
ggplot(ab_data) +
  aes(MFI, antigen) +
  geom_boxplot()
```


## Examine IgG Ab titer levels

IgG is crucial for long-term immunity and responding to bacterial and viral infections

```{r}
igg <- ab_data |>
  filter(isotype == "IgG")
```

```{r}
ggplot(igg) +
  aes(MFI_normalised, antigen) +
  geom_boxplot()
```

```{r}
ggplot(igg) +
  aes(MFI_normalised, antigen, col= infancy_vac) +
  geom_boxplot() 
```

We can "facet" out plot by wP vs aP

```{r}
ggplot(igg) +
  aes(MFI_normalised, antigen, col= infancy_vac) +
  geom_boxplot() + 
  facet_wrap(~infancy_vac)
```

```{r}
ggplot(igg) +
  aes(MFI_normalised, antigen, col=infancy_vac ) +
  geom_boxplot(show.legend = FALSE) + 
  facet_wrap(vars(visit), nrow=2) +
  xlim(0,75) +
  theme_bw()
```


More advanced anaylsis digging into individual antigen responses over time:

```{r}
filter(igg, antigen=="PT", dataset == "2021_dataset") |>
  ggplot() +
  aes(x=planned_day_relative_to_boost,
        y=MFI_normalised,
        col=infancy_vac,
        group=subject_id) +
    geom_point() +
    geom_line() +
  geom_vline(xintercept= 14, linetype="dashed") 
```

This plot shows the time course of Pertussis toxin (PT) antibody responses for a large set of wP (teal color) and aP (red color) individuals. Levels peak at day 14 and are larger in magnitude for wP than aP individuals. 

There are lots of cool things to explore in this data-set and we need coding and biology knowlegde to do it effectively - i.e. us!!!







